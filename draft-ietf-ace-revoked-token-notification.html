<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Notification of Revoked Access Tokens in the Authentication and Authorization for Constrained Environments (ACE) Framework</title>
<meta content="Marco Tiloca" name="author">
<meta content="Ludwig Seitz" name="author">
<meta content="Francesca Palombini" name="author">
<meta content="Sebastian Echeverria" name="author">
<meta content="Grace Lewis" name="author">
<meta content="
       This document specifies a method of the Authentication and Authorization for Constrained  Environments (ACE) framework, which allows an Authorization Server to notify Clients and Resource Servers (i.e., registered devices) about revoked Access Tokens. The method allows Clients and Resource Servers to access a Token Revocation List on the Authorization Server, with the possible additional use of resource observation for the Constrained Application Protocol (CoAP). Resulting (unsolicited) notifications of revoked Access Tokens complement alternative approaches such as token introspection, while not requiring additional endpoints on Clients and Resource Servers. 
    " name="description">
<meta content="xml2rfc 3.12.2" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-ace-revoked-token-notification-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.2
    Python 3.9.7
    appdirs 1.4.4
    ConfigArgParse 1.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.5
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 52.0.0
    six 1.16.0
-->
<link href="draft-ietf-ace-revoked-token-notification.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
dd.break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines */
  line-height: 0;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow, svg + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table .text-left, table .text-left {
  text-align: left;
}
table .text-center, table .text-center {
  text-align: center;
}
table .text-right, table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
/* Trick: a prefix match works because only black and white are allowed */
svg [stroke="black"], svg [stroke^="#000"] {
  stroke: var(--text-color);
}
svg [stroke="white"], svg [stroke^="#fff"] {
  stroke: var(--background-color);
}
svg [fill="black"], svg [fill^="#000"], svg :not([fill]) {
  fill: var(--text-color);
}
svg [stroke="fill"], svg [fill^="#fff"] {
  fill: var(--background-color);
}
}
</style>

</head>
<body>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Notification of Revoked Tokens in ACE</td>
<td class="right">February 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Tiloca, et al.</td>
<td class="center">Expires 31 August 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">ACE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-ace-revoked-token-notification-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-02-27" class="published">27 February 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-08-31">31 August 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Tiloca</div>
<div class="org">RISE AB</div>
</div>
<div class="author">
      <div class="author-name">L. Seitz</div>
<div class="org">Combitech</div>
</div>
<div class="author">
      <div class="author-name">F. Palombini</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">S. Echeverria</div>
<div class="org">CMU SEI</div>
</div>
<div class="author">
      <div class="author-name">G. Lewis</div>
<div class="org">CMU SEI</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Notification of Revoked Access Tokens in the Authentication and Authorization for Constrained Environments (ACE) Framework</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies a method of the Authentication and Authorization for Constrained  Environments (ACE) framework, which allows an Authorization Server to notify Clients and Resource Servers (i.e., registered devices) about revoked Access Tokens. The method allows Clients and Resource Servers to access a Token Revocation List on the Authorization Server, with the possible additional use of resource observation for the Constrained Application Protocol (CoAP). Resulting (unsolicited) notifications of revoked Access Tokens complement alternative approaches such as token introspection, while not requiring additional endpoints on Clients and Resource Servers.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Authentication and Authorization for Constrained Environments Working Group mailing list (ace@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/ace/">https://mailarchive.ietf.org/arch/browse/ace/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/ace-wg/ace-revoked-token-notification">https://github.com/ace-wg/ace-revoked-token-notification</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 31 August 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-protocol-overview" class="xref">Protocol Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-token-hash" class="xref">Token Hash</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-the-trl-resource" class="xref">The TRL Resource</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-update-of-the-trl-resource" class="xref">Update of the TRL Resource</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-the-trl-endpoint" class="xref">The TRL Endpoint</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-full-query-of-the-trl" class="xref">Full Query of the TRL</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-diff-query-of-the-trl" class="xref">Diff Query of the TRL</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-on-using-the-series-transfe" class="xref">On using the Series Transfer Pattern</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-upon-registration" class="xref">Upon Registration</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-notification-of-revoked-tok" class="xref">Notification of Revoked Tokens</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-interaction-examples" class="xref">Interaction Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-full-query-with-observation" class="xref">Full Query with Observation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-diff-query-with-observation" class="xref">Diff Query with Observation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="xref">10.3</a>.  <a href="#name-full-query-with-observation-" class="xref">Full Query with Observation and Additional Diff Query</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="xref">12.1</a>.  <a href="#name-media-type-registrations" class="xref">Media Type Registrations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="xref">12.2</a>.  <a href="#name-coap-content-formats-regist" class="xref">CoAP Content-Formats Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#section-12.3" class="xref">12.3</a>.  <a href="#name-token-revocation-list-regis" class="xref">Token Revocation List Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.4">
                <p id="section-toc.1-1.12.2.4.1"><a href="#section-12.4" class="xref">12.4</a>.  <a href="#name-expert-review-instructions" class="xref">Expert Review Instructions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="xref">13.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="xref">13.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-usage-of-the-cursor-pattern" class="xref">Usage of the "Cursor" Pattern</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#appendix-A.1" class="xref">A.1</a>.  <a href="#name-full-query-request" class="xref">Full Query Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#appendix-A.2" class="xref">A.2</a>.  <a href="#name-full-query-response" class="xref">Full Query Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3">
                <p id="section-toc.1-1.14.2.3.1"><a href="#appendix-A.3" class="xref">A.3</a>.  <a href="#name-diff-query-request" class="xref">Diff Query Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.4">
                <p id="section-toc.1-1.14.2.4.1"><a href="#appendix-A.4" class="xref">A.4</a>.  <a href="#name-diff-query-response" class="xref">Diff Query Response</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.4.2.1">
                    <p id="section-toc.1-1.14.2.4.2.1.1"><a href="#appendix-A.4.1" class="xref">A.4.1</a>.  <a href="#name-empty-collection" class="xref">Empty Collection</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.4.2.2">
                    <p id="section-toc.1-1.14.2.4.2.2.1"><a href="#appendix-A.4.2" class="xref">A.4.2</a>.  <a href="#name-cursor-not-specified-in-the" class="xref">Cursor Not Specified in the Diff Query Request</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.4.2.3">
                    <p id="section-toc.1-1.14.2.4.2.3.1"><a href="#appendix-A.4.3" class="xref">A.4.3</a>.  <a href="#name-cursor-specified-in-the-dif" class="xref">Cursor Specified in the Diff Query Request</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.4.2.4">
                    <p id="section-toc.1-1.14.2.4.2.4.1"><a href="#appendix-A.4.4" class="xref">A.4.4</a>.  <a href="#name-trl-parameters" class="xref">TRL Parameters</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-B" class="xref">Appendix B</a>.  <a href="#name-document-updates" class="xref">Document Updates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#appendix-B.1" class="xref">B.1</a>.  <a href="#name-version-00-to-01" class="xref">Version -00 to -01</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-C" class="xref"></a><a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-D" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Authentication and Authorization for Constrained Environments (ACE) <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span> is a framework that enforces access control on IoT devices acting as Resource Servers. In order to use ACE, both Clients and Resource Servers have to register with an Authorization Server and become a registered device. Once registered, a Client can send a request to the Authorization Server, to obtain an Access Token for a Resource Server. For a Client to access the Resource Server, the Client must present the issued Access Token at the Resource Server, which then validates it before storing it (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.10.1.1" class="relref">Section 5.10.1.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>).<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Even though Access Tokens have expiration times, there are circumstances by which an Access Token may need to be revoked before its expiration time, such as: (1) a registered device has been compromised, or is suspected of being compromised; (2) a registered device is decommissioned; (3) there has been a change in the ACE profile for a registered device; (4) there has been a change in access policies for a registered device; and (5) there has been a change in the outcome of policy evaluation for a registered device (e.g., if policy assessment depends on dynamic conditions in the execution environment, the user context, or the resource utilization).<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">As discussed in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-6.1" class="relref">Section 6.1</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>, only client-initiated revocation is currently specified <span>[<a href="#RFC7009" class="xref">RFC7009</a>]</span> for OAuth 2.0 <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>, based on the assumption that Access Tokens in OAuth are issued with a relatively short lifetime. However, this is not expected to be the case for constrained, intermittently connected devices, that need Access Tokens with relatively long lifetimes.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This document specifies a method for allowing registered devices to access and possibly subscribe to a Token Revocation List (TRL) resource on the Authorization Server, in order to obtain an updated list of revoked, but yet not expired, pertaining Access Tokens. In particular, registered devices can subscribe to the TRL at the Authorization Server by using resource observation <span>[<a href="#RFC7641" class="xref">RFC7641</a>]</span> for the Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">Unlike in the case of token introspection (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.9" class="relref">Section 5.9</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>), a registered device does not provide an owned Access Token to the Authorization Server for inquiring about its current state. Instead, registered devices simply obtain an updated list of revoked, but yet not expired, pertaining Access Tokens, as efficiently identified by corresponding hash values.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">The benefits of this method are that it complements token introspection, and it does not require any additional endpoints on the registered devices. The only additional requirements for registered devices are a request/response interaction with the Authorization Server to access and possibly subscribe to the TRL (see <a href="#sec-overview" class="xref">Section 2</a>), and the lightweight computation of hash values to use as Token identifiers (see <a href="#sec-token-name" class="xref">Section 3</a>).<a href="#section-1-6" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Readers are expected to be familiar with the terms and concepts described in the ACE framework for Authentication and Authorization <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>, as well as with terms and concepts related to CBOR Web Tokens (CWTs) <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span>, and JSON Web Tokens (JWTs) <span>[<a href="#RFC7519" class="xref">RFC7519</a>]</span>. The terminology for entities in the considered architecture is defined in OAuth 2.0 <span>[<a href="#RFC6749" class="xref">RFC6749</a>]</span>. In particular, this includes Client, Resource Server, and Authorization Server.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">Readers are also expected to be familiar with the terms and concepts related to CBOR <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span>, JSON <span>[<a href="#RFC8259" class="xref">RFC8259</a>]</span>, the CoAP protocol <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>, CoAP Observe <span>[<a href="#RFC7641" class="xref">RFC7641</a>]</span>, and the use of hash functions to name objects as defined in <span>[<a href="#RFC6920" class="xref">RFC6920</a>]</span>.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">Note that, unless otherwise indicated, the term "endpoint" is used here following its OAuth definition, aimed at denoting resources such as /token and /introspect at the Authorization Server, and /authz-info at the Resource Server. This document does not use the CoAP definition of "endpoint", which is "An entity participating in the CoAP protocol."<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">This specification also refers to the following terminology.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-6.1">Token hash: identifier of an Access Token, in binary format encoding. The token hash has no relation to other possibly used token identifiers, such as the "cti" (CWT ID) claim of CBOR Web Tokens (CWTs) <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span>.<a href="#section-1.1-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-6.2">Token Revocation List (TRL): a collection of token hashes such that the corresponding Access Tokens have been revoked but are not expired yet.<a href="#section-1.1-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-6.3">TRL resource: a resource on the Authorization Server, with a TRL as its representation.<a href="#section-1.1-6.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-6.4">TRL endpoint: an endpoint at the Authorization Server associated with the TRL resource. The default name of the TRL endpoint in a url-path is '/revoke/trl'. Implementations are not required to use this name, and can define their own instead.<a href="#section-1.1-6.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-6.5">Registered device: a device registered at the Authorization Server, i.e., as a Client, or a Resource Server, or both. A registered device acts as a caller of the TRL endpoint.<a href="#section-1.1-6.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-6.6">Administrator: entity authorized to get full access to the TRL at the Authorization Server, and acting as a caller of the TRL endpoint. An administrator is not necessarily a registered device as defined above, i.e., a Client requesting Access Tokens or a Resource Server consuming Access Tokens. How the administrator authorization is established and verified is out of the scope of this specification.<a href="#section-1.1-6.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-6.7">
            <p id="section-1.1-6.7.1">Pertaining Access Token:<a href="#section-1.1-6.7.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-6.7.2.1">With reference to an administrator, an Access Token issued by the Authorization Server.<a href="#section-1.1-6.7.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-1.1-6.7.2.2">With reference to a registered device, an Access Token intended to be owned by that device. An Access Token pertains to a Client if the Authorization Server has issued the Access Token and provided it to that Client. An Access Token pertains to a Resource Server if the Authorization Server has issued the Access Token to be consumed by that Resource Server.<a href="#section-1.1-6.7.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-overview">
<section id="section-2">
      <h2 id="name-protocol-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
      </h2>
<p id="section-2-1">This protocol defines how a CoAP-based Authorization Server informs Clients and Resource Servers, i.e., registered devices, about pertaining revoked Access Tokens. How the relationship between a registered device and the Authorization Server is established is out of the scope of this specification.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">At a high level, the steps of this protocol are as follows.<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-3.1">Upon startup, the Authorization Server creates a single TRL resource. At any point in time, the TRL resource represents the list of all revoked Access Tokens issued by the Authorization Server that are not expired yet.<a href="#section-2-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-3.2">
          <p id="section-2-3.2.1">When a device registers at the Authorization Server, it also receives the url-path to the TRL resource.<a href="#section-2-3.2.1" class="pilcrow">¶</a></p>
<p id="section-2-3.2.2">
After the registration procedure is finished, the registered device can send an Observation Request to the TRL resource as described in <span>[<a href="#RFC7641" class="xref">RFC7641</a>]</span>, i.e., a GET request with an Observe option set to 0 (register). By doing so, the registered device effectively subscribes to the TRL resource, as interested to receive notifications about its update. Upon receiving the request, the Authorization Server adds the registered device to the list of observers of the TRL resource.<a href="#section-2-3.2.2" class="pilcrow">¶</a></p>
<p id="section-2-3.2.3">
At any time, the registered device can send a GET request to the TRL endpoint. When doing so, it can request for: the current list of pertaining revoked Access Tokens (see <a href="#ssec-trl-full-query" class="xref">Section 6</a>); or the most recent TRL updates occurred over the list of pertaining revoked Access Tokens (see <a href="#ssec-trl-diff-query" class="xref">Section 7</a>). In either case, the registered device may especially rely on an Observation Request for subscribing to the TRL resource as discussed above.<a href="#section-2-3.2.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.3">
          <p id="section-2-3.3.1">When an Access Token is revoked, the Authorization Server adds the corresponding token hash to the TRL. Also, when a revoked Access Token eventually expires, the Authorization Server removes the corresponding token hash from the TRL.<a href="#section-2-3.3.1" class="pilcrow">¶</a></p>
<p id="section-2-3.3.2">
In either case, after updating the TRL, the Authorization Server sends Observe Notifications as per <span>[<a href="#RFC7641" class="xref">RFC7641</a>]</span>. That is, an Observe Notification is sent to each registered device subscribed to the TRL resource and to which the Access Token pertains.<a href="#section-2-3.3.2" class="pilcrow">¶</a></p>
<p id="section-2-3.3.3">
Depending on the specific subscription established through the observation request, the notification provides the current updated list of revoked Access Tokens in the portion of the TRL pertaining to that device (see <a href="#ssec-trl-full-query" class="xref">Section 6</a>), or rather the most recent TRL updates occurred over that list of pertaining revoked Access Tokens (see <a href="#ssec-trl-diff-query" class="xref">Section 7</a>).<a href="#section-2-3.3.3" class="pilcrow">¶</a></p>
<p id="section-2-3.3.4">
Further Observe Notifications may be sent, consistently with ongoing additional observations of the TRL resource.<a href="#section-2-3.3.4" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.4">An administrator can access and subscribe to the TRL like a registered device, while getting the full updated representation of the TRL.<a href="#section-2-3.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-4"><a href="#fig-protocol-overview" class="xref">Figure 1</a> shows a high-level overview of the service provided by this protocol. In particular, it shows the Observe Notifications sent by the Authorization Server to one administrator and four registered devices, upon revocation of the issued Access Tokens t1, t2 and t3, with token hash th1, th2 and th3, respectively. Each dotted line associated with a pair of registered devices indicates the Access Token that they both own.<a href="#section-2-4" class="pilcrow">¶</a></p>
<span id="name-protocol-overview-2"></span><div id="fig-protocol-overview">
<figure id="figure-1">
        <div class="alignCenter art-text artwork" id="section-2-5.1">
<pre>
                    +----------------------+
                    | Authorization Server |
                    +-----------o----------+
                    revoke/trl  |  TRL: {th1,th2,th3}
                                |
 +-----------------+------------+------------+------------+
 |                 |            |            |            |
 | th1,th2,th3     | th1,th2    | th1        | th3        | th2,th3
 v                 v            v            v            v
+---------------+ +----------+ +----------+ +----------+ +----------+
| Administrator | | Client 1 | | Resource | | Client 2 | | Resource |
|               | |          | | Server 1 | |          | | Server 2 |
+---------------+ +----------+ +----------+ +----------+ +----------+
                     :    :        :           :            :    :
                     :    :   t1   :           :     t3     :    :
                     :    :........:           :............:    :
                     :                   t2                      :
                     :...........................................:

</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-protocol-overview-2" class="selfRef">Protocol Overview</a>
        </figcaption></figure>
</div>
<p id="section-2-6"><a href="#sec-RS-examples" class="xref">Section 10</a> provides examples of the protocol flow and message exchange between the Authorization Server and a registered device.<a href="#section-2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-token-name">
<section id="section-3">
      <h2 id="name-token-hash">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-token-hash" class="section-name selfRef">Token Hash</a>
      </h2>
<p id="section-3-1">The token hash of an Access Token is computed as follows.<a href="#section-3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-2">
<li id="section-3-2.1">
          <p id="section-3-2.1.1">The Authorization Server defines ENCODED_TOKEN, as the content of the 'access_token' parameter in the Authorization Server response (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.8.2" class="relref">Section 5.8.2</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>), where the Access Token was included and provided to the requesting Client.<a href="#section-3-2.1.1" class="pilcrow">¶</a></p>
<p id="section-3-2.1.2">
Note that the content of the 'access_token' parameter is either:<a href="#section-3-2.1.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1.3.1">A CBOR byte string, if the Access Token was transported using CBOR. With reference to the example in <a href="#fig-as-response-cbor" class="xref">Figure 2</a>, and assuming the string's length in bytes to be 119 (i.e., 0x77 in hexadecimal), then ENCODED_TOKEN takes the bytes {0x58 0x77 0xd0 0x83 0x44 0xa1 ...}, i.e., the raw content of the parameter 'access_token'.<a href="#section-3-2.1.3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3-2.1.3.2">A text string, if the Access Token was transported using JSON. With reference to the example in <a href="#fig-as-response-json" class="xref">Figure 3</a>, ENCODED_TOKEN takes "2YotnFZFEjr1zCsicMWpAA", i.e., the raw content of the parameter 'access_token'.<a href="#section-3-2.1.3.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li id="section-3-2.2">
          <p id="section-3-2.2.1">The Authorization Server defines HASH_INPUT as follows.<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.2.2.1">If CBOR was used to transport the Access Token (as a CWT or JWT), HASH_INPUT takes the same value of ENCODED_TOKEN.<a href="#section-3-2.2.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3-2.2.2.2">
              <p id="section-3-2.2.2.2.1">If JSON was used to transport the Access Token (as a CWT or JWT), HASH_INPUT takes the serialization of ENCODED_TOKEN.<a href="#section-3-2.2.2.2.1" class="pilcrow">¶</a></p>
<p id="section-3-2.2.2.2.2">
In either case, HASH_INPUT results in the binary representation of the content of the 'access_token' parameter from the Authorization Server response.<a href="#section-3-2.2.2.2.2" class="pilcrow">¶</a></p>
</li>
          </ul>
</li>
        <li id="section-3-2.3">
          <p id="section-3-2.3.1">The Authorization Server generates a hash value of HASH_INPUT as per <span><a href="https://rfc-editor.org/rfc/rfc6920#section-6" class="relref">Section 6</a> of [<a href="#RFC6920" class="xref">RFC6920</a>]</span>. The resulting output in binary format is used as the token hash. Note that the used binary format embeds the identifier of the used hash function, in the first byte of the computed token hash.<a href="#section-3-2.3.1" class="pilcrow">¶</a></p>
<p id="section-3-2.3.2">
The specifically used hash function MUST be collision-resistant on byte-strings, and MUST be selected from the "Named Information Hash Algorithm" Registry <span>[<a href="#Named.Information.Hash.Algorithm" class="xref">Named.Information.Hash.Algorithm</a>]</span>.<a href="#section-3-2.3.2" class="pilcrow">¶</a></p>
<p id="section-3-2.3.3">
The Authorization Server specifies the used hash function to registered devices during their registration procedure (see <a href="#sec-registration" class="xref">Section 8</a>).<a href="#section-3-2.3.3" class="pilcrow">¶</a></p>
</li>
      </ol>
<span id="name-example-of-authorization-se"></span><div id="fig-as-response-cbor">
<figure id="figure-2">
        <div class="alignLeft art-text artwork" id="section-3-3.1">
<pre>
2.01 Created
Content-Format: application/ace+cbor
Max-Age: 85800
Payload:
{
   access_token : h'd08344a1...'
   (remainder of the Access Token omitted for brevity)
   token_type : pop,
   expires_in : 86400,
   profile    : coap_dtls,
   (remainder of the response omitted for brevity)
}
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-example-of-authorization-se" class="selfRef">Example of Authorization Server response using CBOR</a>
        </figcaption></figure>
</div>
<span id="name-example-of-authorization-ser"></span><div id="fig-as-response-json">
<figure id="figure-3">
        <div class="alignLeft art-text artwork" id="section-3-4.1">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store
Pragma: no-cache
Payload:
{
   "access_token" : "2YotnFZFEjr1zCsicMWpAA"
   (remainder of the Access Token omitted for brevity)
   "token_type" : "pop",
   "expires_in" : 86400,
   "profile"    : "coap_dtls",
   (remainder of the response omitted for brevity)
}
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-example-of-authorization-ser" class="selfRef">Example of Authorization Server response using JSON</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="sec-trl-resource">
<section id="section-4">
      <h2 id="name-the-trl-resource">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-the-trl-resource" class="section-name selfRef">The TRL Resource</a>
      </h2>
<p id="section-4-1">Upon startup, the Authorization Server creates a single TRL resource, encoded as a CBOR array.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">Each element of the array is a CBOR byte string, with value the token hash of an Access Token. The order of the token hashes in the CBOR array is irrelevant, and the CBOR array MUST be treated as a set in which the order has no significant meaning.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">The TRL is initialized as empty, i.e., the initial content of the TRL resource representation MUST be an empty CBOR array.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="ssec-trl-update">
<section id="section-4.1">
        <h3 id="name-update-of-the-trl-resource">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-update-of-the-trl-resource" class="section-name selfRef">Update of the TRL Resource</a>
        </h3>
<p id="section-4.1-1">The Authorization Server updates the TRL in the following two cases.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1">When a non-expired Access Token is revoked, the token hash of the Access Token is added to the TRL resource representation. That is, a CBOR byte string with the token hash as its value is added to the CBOR array used as TRL resource representation.<a href="#section-4.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-2.2">When a revoked Access Token expires, the token hash of the Access Token is removed from the TRL resource representation. That is, the CBOR byte string with the token hash as its value is removed from the CBOR array used as TRL resource representation.<a href="#section-4.1-2.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-trl-endpoint">
<section id="section-5">
      <h2 id="name-the-trl-endpoint">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-the-trl-endpoint" class="section-name selfRef">The TRL Endpoint</a>
      </h2>
<p id="section-5-1">Consistent with <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-6.5" class="relref">Section 6.5</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>, all communications between a caller of the TRL endpoint and the Authorization Server MUST be encrypted, as well as integrity and replay protected. Furthermore, responses from the Authorization Server to the caller MUST be bound to the caller's request.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">The Authorization Server MUST implement measures to prevent access to the TRL endpoint by entities other than registered devices and authorized administrators.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">The TRL endpoint supports only the GET method, and allows two types of query of the TRL.<a href="#section-5-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-4.1">Full query: the Authorization Server returns the token hashes of the revoked Access Tokens currently in the TRL and pertaining to the requester. The Authorization Server MUST support this type of query. The processing of a full query and the related response format are defined in <a href="#ssec-trl-full-query" class="xref">Section 6</a>.<a href="#section-5-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-4.2">
          <p id="section-5-4.2.1">Diff query: the Authorization Server returns a list of diff entries. Each diff entry is related to one of the most recent updates, in the portion of the TRL pertaining to the requester. The Authorization Server MAY support this type of query.<a href="#section-5-4.2.1" class="pilcrow">¶</a></p>
<p id="section-5-4.2.2">
The entry associated with one of such updates contains a list of token hashes, such that: i) the corresponding revoked Access Tokens pertain to the requester; and ii) they were added to or removed from the TRL at that update. The processing of a diff query and the related response format are defined in <a href="#ssec-trl-diff-query" class="xref">Section 7</a>.<a href="#section-5-4.2.2" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-5-5">The TRL endpoint allows the following query parameter in a GET request.<a href="#section-5-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-6.1">
          <p id="section-5-6.1.1">'pmax': if included, it follows the semantics defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-conditional-attributes-02#section-3.2.2" class="relref">Section 3.2.2</a> of [<a href="#I-D.ietf-core-conditional-attributes" class="xref">I-D.ietf-core-conditional-attributes</a>]</span>. This query parameter is relevant only in case the GET request is specifically an Observation Request, i.e., if it includes the CoAP Observe option set to 0 (register). In such a case, this parameter indicates the maximum time, in seconds, between two consecutive notifications for the observation in question, regardless whether the TRL resource has changed or not.<a href="#section-5-6.1.1" class="pilcrow">¶</a></p>
<p id="section-5-6.1.2">
If the Observation Request does not include the 'pmax' parameter, the maximum time to consider is up to the Authorization Server. If the Observation Request includes the 'pmax' parameter, its value MUST be greater than zero, otherwise the Authorization Server MUST return a 4.00 (Bad Request) response.<a href="#section-5-6.1.2" class="pilcrow">¶</a></p>
<p id="section-5-6.1.3">
If the GET request is not an Observation Request, the Authorization Server MUST ignore the 'pmax' parameter, in case this is included.<a href="#section-5-6.1.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-6.2">
          <p id="section-5-6.2.1">'diff': if included, it indicates to perform a diff query of the TRL (see <a href="#ssec-trl-diff-query" class="xref">Section 7</a>). Its value MUST be either:<a href="#section-5-6.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-6.2.2.1">the integer 0, indicating that a (notification) response should include as many diff entries as the Authorization Server can provide in the response; or<a href="#section-5-6.2.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5-6.2.2.2">a positive integer greater than 0, indicating the maximum number of diff entries that a (notification) response should include.<a href="#section-5-6.2.2.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
      </ul>
</section>
</div>
<div id="ssec-trl-full-query">
<section id="section-6">
      <h2 id="name-full-query-of-the-trl">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-full-query-of-the-trl" class="section-name selfRef">Full Query of the TRL</a>
      </h2>
<p id="section-6-1">In order to produce a (notification) response to a GET request asking for a full query of the TRL, the Authorization Server performs the following actions.<a href="#section-6-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-2">
<li id="section-6-2.1">
          <p id="section-6-2.1.1">From the current TRL resource representation, the Authorization Server builds a set HASHES, such that:<a href="#section-6-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.1.2.1">If the requester is a registered device, HASHES specifies the token hashes of the Access Tokens pertaining to that registered device. The Authorization Server can use the authenticated identity of the registered device to perform the necessary filtering on the TRL resource representation.<a href="#section-6-2.1.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6-2.1.2.2">If the requester is an administrator, HASHES specifies all the token hashes in the current TRL resource representation.<a href="#section-6-2.1.2.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li id="section-6-2.2">
          <p id="section-6-2.2.1">The Authorization Server sends a 2.05 (Content) Response to the requester, with a CBOR array 'full-set' as payload. Each element of the array specifies one of the token hashes from the set HASHES, encoded as a CBOR byte string.<a href="#section-6-2.2.1" class="pilcrow">¶</a></p>
<p id="section-6-2.2.2">
The order of the token hashes in the CBOR array is irrelevant, i.e., the CBOR array MUST be treated as a set in which the order has no significant meaning.<a href="#section-6-2.2.2" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-6-3">The CDDL definition <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span> of the CBOR array 'full-set' specified as payload in the response from the Authorization Server is provided below.<a href="#section-6-3" class="pilcrow">¶</a></p>
<span id="name-cddl-definition-of-the-resp"></span><div id="cddl-full">
<figure id="figure-4">
        <div class="alignLeft art-CDDL art-text artwork" id="section-6-4.1">
<pre>
   token-hash = bytes
   full-set = [* token-hash]
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-cddl-definition-of-the-resp" class="selfRef">CDDL definition of the response payload following a Full Query request to the TRL endpoint</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="ssec-trl-diff-query">
<section id="section-7">
      <h2 id="name-diff-query-of-the-trl">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-diff-query-of-the-trl" class="section-name selfRef">Diff Query of the TRL</a>
      </h2>
<p id="section-7-1">In order to produce a (notification) response to a GET request asking for a diff query of the TRL, the Authorization Server performs the following actions.<a href="#section-7-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7-2">
<li id="section-7-2.1">The Authorization Server defines the positive integer NUM. If the value N specified in the query parameter 'diff' in the GET request is equal to 0 or greater than a pre-defined positive integer N_MAX, then NUM takes the value of N_MAX. Otherwise, NUM takes N.<a href="#section-7-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-7-2.2">
          <p id="section-7-2.2.1">The Authorization Server prepares U = min(NUM, SIZE) diff entries, where SIZE &lt;= N_MAX is the number of TRL updates pertaining to the requester and currently stored at the Authorization Server. That is, the diff entries are related to the U most recent TRL updates pertaining to the requester. In particular, the first entry refers to the most recent of such updates, the second entry refers to the second from last of such updates, and so on.<a href="#section-7-2.2.1" class="pilcrow">¶</a></p>
<p id="section-7-2.2.2">
Each diff entry is a CBOR array 'diff-entry', which includes the following two elements.<a href="#section-7-2.2.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.2.3.1">The first element is a CBOR array 'removed'. Each element of the array is a CBOR byte string, with value the token hash of an Access Token such that: it pertained to the requester; and it was removed from the TRL during the update associated with the diff entry.<a href="#section-7-2.2.3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7-2.2.3.2">The second element is a CBOR array 'added'. Each element of the array is a CBOR byte string, with value the token hash of an Access Token such that: it pertains to the requester; and it was added to the TRL during the update associated with the diff entry.<a href="#section-7-2.2.3.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-7-2.2.4">
The order of the token hashes in the CBOR arrays 'removed' and 'added' is irrelevant. That is, the CBOR arrays 'removed' and 'added' MUST be treated as a set in which the order of elements has no significant meaning.<a href="#section-7-2.2.4" class="pilcrow">¶</a></p>
</li>
        <li id="section-7-2.3">
          <p id="section-7-2.3.1">The Authorization Server prepares a 2.05 (Content) Response for the requester, with a CBOR array 'diff-set' of U elements as payload. Each element of the CBOR array 'diff-set' specifies one of the CBOR arrays 'diff-entry' prepared at step 2 as diff entries.<a href="#section-7-2.3.1" class="pilcrow">¶</a></p>
<p id="section-7-2.3.2">
Within the CBOR array 'diff-set', the CBOR arrays 'diff-entry' MUST be sorted to reflect the corresponding updates to the TRL in reverse chronological order. That is, the first 'diff-entry' element of 'diff-set' relates to the most recent update to the portion of the TRL pertaining to the requester. The second 'diff-entry' element of 'diff-set' relates to the second from last most recent update to that portion, and so on.<a href="#section-7-2.3.2" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-7-3">The CDDL definition <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span> of the CBOR array 'diff-set' specified as payload in the response from the Authorization Server is provided below.<a href="#section-7-3" class="pilcrow">¶</a></p>
<span id="name-cddl-definition-of-the-respo"></span><div id="cddl-diff">
<figure id="figure-5">
        <div class="alignLeft art-CDDL art-text artwork" id="section-7-4.1">
<pre>
   token-hash = bytes
   trl-patch = [* token-hash]
   diff-entry = [removed: trl-patch, added: trl-patch]
   diff-set = [* diff-entry]
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-cddl-definition-of-the-respo" class="selfRef">CDDL definition of the response payload following a Diff Query request to the TRL endpoint</a>
        </figcaption></figure>
</div>
<p id="section-7-5">If the Authorization Server supports diff queries:<a href="#section-7-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-6.1">The Authorization Server MUST return a 4.00 (Bad Request) response in case the query parameter 'diff' of the GET request specifies a value other than 0 or than a positive integer.<a href="#section-7-6.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-6.2">The Authorization Server MUST keep track of N_MAX most recent updates to the portion of the TRL that pertains to each caller of the TRL endpoint. The particular method to achieve this is implementation-specific.<a href="#section-7-6.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-6.3">When SIZE is equal to N_MAX, and a new TRL update occurs as pertaining to a registered device, the Authorization Server MUST first delete the oldest stored update for that device, before storing this latest update as the most recent one for that device.<a href="#section-7-6.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-6.4">The Authorization Server SHOULD provide registered devices and administrators with the value of N_MAX, upon their registration (see <a href="#sec-registration" class="xref">Section 8</a>).<a href="#section-7-6.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-7-7">If the Authorization Server does not support diff queries, it ignores the query parameter 'diff' in the GET request and proceeds as when processing a full query of the TRL (see <a href="#ssec-trl-full-query" class="xref">Section 6</a>).<a href="#section-7-7" class="pilcrow">¶</a></p>
<p id="section-7-8"><a href="#sec-series-pattern" class="xref">Section 7.1</a> discusses how the diff query of the TRL is in fact a usage example of the Series Transfer Pattern defined in <span>[<a href="#I-D.bormann-t2trg-stp" class="xref">I-D.bormann-t2trg-stp</a>]</span>.<a href="#section-7-8" class="pilcrow">¶</a></p>
<p id="section-7-9"><a href="#sec-cursor-pattern" class="xref">Appendix A</a> discusses how the diff query of the TRL can be further improved by using the "Cursor" pattern defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-bormann-t2trg-stp-03#section-3.3" class="relref">Section 3.3</a> of [<a href="#I-D.bormann-t2trg-stp" class="xref">I-D.bormann-t2trg-stp</a>]</span>.<a href="#section-7-9" class="pilcrow">¶</a></p>
<div id="sec-series-pattern">
<section id="section-7.1">
        <h3 id="name-on-using-the-series-transfe">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-on-using-the-series-transfe" class="section-name selfRef">On using the Series Transfer Pattern</a>
        </h3>
<p id="section-7.1-1">The diff query of the TRL defined in <a href="#ssec-trl-diff-query" class="xref">Section 7</a> is a usage example of the Series Transfer Pattern defined in <span>[<a href="#I-D.bormann-t2trg-stp" class="xref">I-D.bormann-t2trg-stp</a>]</span>.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">That is, a diff query enables the transfer of a series of TRL updates, with the Authorization Server specifying U &lt;= N_MAX diff entries as the U most recent  updates to the portion of the TRL pertaining to a registered device.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3">For each registered device, the Authorization Server maintains an update collection of maximum N_MAX items. Each time the TRL changes, the Authorization Server performs the following operations for each registered device.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.1-4">
<li id="section-7.1-4.1">The Authorization Server considers the portion of the TRL pertaining to that registered device. If the TRL portion is not affected by this TRL update, the Authorization Server stops the processing for that registered device.<a href="#section-7.1-4.1" class="pilcrow">¶</a>
</li>
          <li id="section-7.1-4.2">Otherwise, the Authorization Server creates two sets 'trl_patch' of token hashes, i.e., one  "removed" set and one "added" set, as related to this TRL update.<a href="#section-7.1-4.2" class="pilcrow">¶</a>
</li>
          <li id="section-7.1-4.3">The Authorization Server fills the two sets with the token hashes of the removed and added Access Tokens, respectively, from/to the TRL portion from step 1.<a href="#section-7.1-4.3" class="pilcrow">¶</a>
</li>
          <li id="section-7.1-4.4">The Authorization Server creates a new series item including the two sets from step 3, and adds the series item to the update collection associated with the registered device.<a href="#section-7.1-4.4" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-7.1-5">When responding to a diff query request from a registered device (see <a href="#ssec-trl-diff-query" class="xref">Section 7</a>), 'diff-set' is a subset of the collection associated with the requester, where each 'diff_entry' record is a series item from that collection. Note that 'diff-set' specifies the whole current collection when the value of U is equal to SIZE, i.e., the current number of series items in the collection.<a href="#section-7.1-5" class="pilcrow">¶</a></p>
<p id="section-7.1-6">The value N of the query parameter 'diff' in the GET request allows the requester and the Authorization Server to trade the amount of provided information with the latency of the information transfer.<a href="#section-7.1-6" class="pilcrow">¶</a></p>
<p id="section-7.1-7">Since the collection associated with each registered device includes up to N_MAX series item, the Authorization Server deletes the oldest series item when a new one is generated and added to the end of the collection, due to a new TRL update pertaining to that registered device. This addresses the question "When can the server decide to no longer retain older items?" in <span><a href="https://datatracker.ietf.org/doc/html/draft-bormann-t2trg-stp-03#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.bormann-t2trg-stp" class="xref">I-D.bormann-t2trg-stp</a>]</span>.<a href="#section-7.1-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-registration">
<section id="section-8">
      <h2 id="name-upon-registration">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-upon-registration" class="section-name selfRef">Upon Registration</a>
      </h2>
<p id="section-8-1">During the registration process at the Authorization Server, an administrator or a registered device receives the following information as part of the registration response.<a href="#section-8-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-2.1">The url-path to the TRL endpoint at the Authorization Server.<a href="#section-8-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.2">The hash function used to compute token hashes. This is specified as an integer or a text string, taking value from the "ID" or "Hash Name String" column of the "Named Information Hash Algorithm" Registry <span>[<a href="#Named.Information.Hash.Algorithm" class="xref">Named.Information.Hash.Algorithm</a>]</span>, respectively.<a href="#section-8-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.3">Optionally, a positive integer N_MAX, if the Authorization Server supports diff queries of the TRL resource (see <a href="#ssec-trl-diff-query" class="xref">Section 7</a>).<a href="#section-8-2.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-8-3">After the registration procedure is finished, the administrator or registered device can send a GET request to the TRL resource, including the CoAP Observe option set to 0 (register), in order to start an observation of the TRL resource at the Authorization Server as per <span><a href="https://rfc-editor.org/rfc/rfc7641#section-3.1" class="relref">Section 3.1</a> of [<a href="#RFC7641" class="xref">RFC7641</a>]</span>. The GET request can express the wish for a full query (see <a href="#ssec-trl-full-query" class="xref">Section 6</a>) or a diff query (see <a href="#ssec-trl-diff-query" class="xref">Section 7</a>) of the TRL.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">In case the request is successfully processed, the Authorization Server replies with a response speficying the CoAP response code 2.05 (Content) and including the CoAP Observe option. The payload of the response is formatted as defined in <a href="#ssec-trl-full-query" class="xref">Section 6</a> or in <a href="#ssec-trl-diff-query" class="xref">Section 7</a>, in case the GET yielded the execution of a full query or a diff query of the TRL, respectively.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">Further details about the registration process at the Authorization Server are out of scope for this specification. Note that the registration process is also out of the scope of the ACE framework for Authentication and Authorization (see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-ace-oauth-authz-46#section-5.5" class="relref">Section 5.5</a> of [<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>).<a href="#section-8-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-notification">
<section id="section-9">
      <h2 id="name-notification-of-revoked-tok">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-notification-of-revoked-tok" class="section-name selfRef">Notification of Revoked Tokens</a>
      </h2>
<p id="section-9-1">When the TRL is updated (see <a href="#ssec-trl-update" class="xref">Section 4.1</a>), the Authorization Server sends Observe Notifications to the observers of the TRL resource. Observe Notifications are sent as per <span><a href="https://rfc-editor.org/rfc/rfc7641#section-4.2" class="relref">Section 4.2</a> of [<a href="#RFC7641" class="xref">RFC7641</a>]</span>.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">If the 'pmax' query parameter was specified in the Observation Request starting an observation (see <a href="#sec-trl-endpoint" class="xref">Section 5</a>), the Authorization Server might accordingly send additional Observe Notifications to the associated observer. That is, the Authorization Server ensures that no more than pmax seconds elapse between two consecutive notifications sent to that observer, regardless whether the TRL resource has changed or not. If the 'pmax' query parameter was not specified in the Observation Request, a possible maximum time to consider is up to the Authorization Server.<a href="#section-9-2" class="pilcrow">¶</a></p>
<p id="section-9-3">The payload of each Observe Notification is formatted as defined in <a href="#ssec-trl-full-query" class="xref">Section 6</a> or in <a href="#ssec-trl-diff-query" class="xref">Section 7</a>, in case the original Observation Request yielded the execution of a full query or a diff query of the TRL, respectively.<a href="#section-9-3" class="pilcrow">¶</a></p>
<p id="section-9-4">Furthermore, an administrator or a registered device can send additional GET requests to the TRL endpoint at any time, in order to retrieve the token hashes of the pertaining revoked Access Tokens. When doing so, the caller of the TRL endpoint can perform a full query (see <a href="#ssec-trl-full-query" class="xref">Section 6</a>) or a diff query (see <a href="#ssec-trl-diff-query" class="xref">Section 7</a>).<a href="#section-9-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-RS-examples">
<section id="section-10">
      <h2 id="name-interaction-examples">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-interaction-examples" class="section-name selfRef">Interaction Examples</a>
      </h2>
<p id="section-10-1">This section provides examples of interactions between a Resource Server RS as a registered device and an Authorization Server AS. The Authorization Server supports both full query and diff query of the TRL, as defined in <a href="#ssec-trl-full-query" class="xref">Section 6</a> and <a href="#ssec-trl-diff-query" class="xref">Section 7</a>, respectively.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">The details of the registration process are omitted, but it is assumed that the Resource Server sends an unspecified payload to the Authorization Server, which replies with a 2.01 (Created) response.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3">The payload of the registration response is a CBOR map, which includes the following entries:<a href="#section-10-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10-4.1">a "trl_path" parameter, specifying the path of the TRL resource;<a href="#section-10-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-10-4.2">a "trl_hash" parameter, specifying the hash function used to computed token hashes as defined in <a href="#sec-token-name" class="xref">Section 3</a>;<a href="#section-10-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-10-4.3">an "n_max" parameter, specifying the value of N_MAX, i.e., the maximum number of TRL updates pertaining to each registered device that the Authorization Server retains for that device (see <a href="#ssec-trl-diff-query" class="xref">Section 7</a>);<a href="#section-10-4.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-10-4.4">possible further parameters related to the registration process.<a href="#section-10-4.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-10-5">Furthermore, 'h(x)' refers to the hash function used to compute the token hashes, as defined in <a href="#sec-token-name" class="xref">Section 3</a> of this specification and according to <span>[<a href="#RFC6920" class="xref">RFC6920</a>]</span>. Assuming the usage of CWTs transported in CBOR, 'bstr.h(t1)' and 'bstr.h(t2)' denote the byte-string representations of the token hashes for the Access Tokens t1 and t2, respectively.<a href="#section-10-5" class="pilcrow">¶</a></p>
<div id="sec-RS-example-1">
<section id="section-10.1">
        <h3 id="name-full-query-with-observation">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-full-query-with-observation" class="section-name selfRef">Full Query with Observation</a>
        </h3>
<p id="section-10.1-1"><a href="#fig-RS-AS" class="xref">Figure 6</a> shows an interaction example considering a CoAP observation and a full query of the TRL.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<span id="name-interaction-for-full-query-"></span><div id="fig-RS-AS">
<figure id="figure-6">
          <div class="alignCenter art-text artwork" id="section-10.1-2.1">
<pre>
RS                                     AS
|                                       |
| Registration: POST                    |
+--------------------------------------&gt;|
|                                       |
|&lt;--------------------------------------+
|        2.01 CREATED                   |
|         Payload: {                    |
|          ...                          |
|            "trl_path" = "revoke/trl", |
|            "trl_hash" = "sha-256",    |
|            "n_max" = 10               |
|         }                             |
|                                       |
| GET Observe: 0                        |
|  coap://example.as.com/revoke/trl/    |
+--------------------------------------&gt;|
|                                       |
|&lt;--------------------------------------+
|              2.05 CONTENT Observe: 42 |
|               Payload: []             |
|                   .                   |
|                   .                   |
|                   .                   |
|                                       |
|    (Access Tokens t1 and t2 issued    |
|   and successfully submitted to RS)   |
|                   .                   |
|                   .                   |
|                   .                   |
|                                       |
|                                       |
|     (Access Token t1 is revoked)      |
|                                       |
|&lt;--------------------------------------+
|              2.05 CONTENT Observe: 53 |
|               Payload: [bstr.h(t1)]   |
|                   .                   |
|                   .                   |
|                   .                   |
|                                       |
|     (Access Token t2 is revoked)      |
|                                       |
|&lt;--------------------------------------+
|              2.05 CONTENT Observe: 64 |
|               Payload: [bstr.h(t1),   |
|                         bstr.h(t2)]   |
|                   .                   |
|                   .                   |
|                   .                   |
|                                       |
|       (Access Token t1 expires)       |
|                                       |
|&lt;--------------------------------------+
|              2.05 CONTENT Observe: 75 |
|               Payload: [bstr.h(t2)]   |
|                   .                   |
|                   .                   |
|                   .                   |
|                                       |
|       (Access Token t2 expires)       |
|                                       |
|&lt;--------------------------------------+
|              2.05 CONTENT Observe: 86 |
|               Payload: []             |
|                                       |
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-interaction-for-full-query-" class="selfRef">Interaction for Full Query with Observation</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-RS-example-2">
<section id="section-10.2">
        <h3 id="name-diff-query-with-observation">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-diff-query-with-observation" class="section-name selfRef">Diff Query with Observation</a>
        </h3>
<p id="section-10.2-1"><a href="#fig-RS-AS-2" class="xref">Figure 7</a> shows an interaction example considering a CoAP observation and a diff query of the TRL.<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<p id="section-10.2-2">The Resource Server indicates N=3 as value of the query parameter "diff", i.e., as the maximum number of diff entries to be specified in a response from the Authorization Server.<a href="#section-10.2-2" class="pilcrow">¶</a></p>
<span id="name-interaction-for-diff-query-"></span><div id="fig-RS-AS-2">
<figure id="figure-7">
          <div class="alignCenter art-text artwork" id="section-10.2-3.1">
<pre>
RS                                            AS
|                                              |
| Registration: POST                           |
+---------------------------------------------&gt;|
|                                              |
|&lt;---------------------------------------------+
|               2.01 CREATED                   |
|                Payload: {                    |
|                   ...                        |
|                   "trl_path" = "revoke/trl", |
|                   "trl_hash" = "sha-256",    |
|                   "n_max" = 10               |
|                }                             |
|                                              |
| GET Observe: 0                               |
|  coap://example.as.com/revoke/trl?diff=3     |
+---------------------------------------------&gt;|
|                                              |
|&lt;---------------------------------------------+
|                     2.05 CONTENT Observe: 42 |
|                      Payload: []             |
|                        .                     |
|                        .                     |
|                        .                     |
|                                              |
|         (Access Tokens t1 and t2 issued      |
|         and successfully submitted to RS)    |
|                        .                     |
|                        .                     |
|                        .                     |
|                                              |
|          (Access Token t1 is revoked)        |
|                                              |
|&lt;---------------------------------------------+
|            2.05 CONTENT Observe: 53          |
|             Payload: [                       |
|                        [ [], [bstr.h(t1)] ]  |
|                      ]                       |
|                                              |
|                                              |
|                        .                     |
|                        .                     |
|                        .                     |
|                                              |
|          (Access Token t2 is revoked)        |
|                                              |
|&lt;---------------------------------------------+
|            2.05 CONTENT Observe: 64          |
|             Payload: [                       |
|                        [ [], [bstr.h(t2)] ], |
|                        [ [], [bstr.h(t1)] ]  |
|                      ]                       |
|                        .                     |
|                        .                     |
|                        .                     |
|                                              |
|          (Access Token t1 expires)           |
|                                              |
|&lt;---------------------------------------------+
|            2.05 CONTENT Observe: 75          |
|             Payload: [                       |
|                        [ [bstr.h(t1)], [] ], |
|                        [ [], [bstr.h(t2)] ], |
|                        [ [], [bstr.h(t1)] ]  |
|                      ]                       |
|                        .                     |
|                        .                     |
|                        .                     |
|                                              |
|          (Access Token t2 expires)           |
|                                              |
|&lt;---------------------------------------------+
|            2.05 CONTENT Observe: 86          |
|             Payload: [                       |
|                        [ [bstr.h(t2)], [] ], |
|                        [ [bstr.h(t1)], [] ], |
|                        [ [], [bstr.h(t2)] ]  |
|                      ]                       |
|                                              |
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-interaction-for-diff-query-" class="selfRef">Interaction for Diff Query with Observation</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-RS-example-3">
<section id="section-10.3">
        <h3 id="name-full-query-with-observation-">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-full-query-with-observation-" class="section-name selfRef">Full Query with Observation and Additional Diff Query</a>
        </h3>
<p id="section-10.3-1"><a href="#fig-RS-AS-3" class="xref">Figure 8</a> shows an interaction example considering a CoAP observation and a full query of the TRL.<a href="#section-10.3-1" class="pilcrow">¶</a></p>
<p id="section-10.3-2">The example also considers one of the notifications from the Authorization Server to get lost in transmission, and thus not reaching the Resource Server.<a href="#section-10.3-2" class="pilcrow">¶</a></p>
<p id="section-10.3-3">When this happens, and after a waiting time defined by the application has elapsed, the Resource Server sends a GET request with no Observe Option to the Authorization Server, to perform a diff query of the TRL. The Resource Server indicates N=8 as value of the query parameter "diff", i.e., as the maximum number of diff entries to be specified in a response from the Authorization Server.<a href="#section-10.3-3" class="pilcrow">¶</a></p>
<span id="name-interaction-for-full-query-w"></span><div id="fig-RS-AS-3">
<figure id="figure-8">
          <div class="alignCenter art-text artwork" id="section-10.3-4.1">
<pre>
RS                                            AS
|                                              |
| Registration: POST                           |
+---------------------------------------------&gt;|
|                                              |
|&lt;---------------------------------------------+
|               2.01 CREATED                   |
|                Payload: {                    |
|                   ...                        |
|                   "trl_path" = "revoke/trl", |
|                   "trl_hash" = "sha-256",    |
|                   "n_max" = 10               |
|                }                             |
|                                              |
| GET Observe: 0                               |
|  coap://example.as.com/revoke/trl/           |
+---------------------------------------------&gt;|
|                                              |
|&lt;---------------------------------------------+
|                     2.05 CONTENT Observe: 42 |
|                      Payload: []             |
|                       .                      |
|                       .                      |
|                       .                      |
|                                              |
|      (Access Tokens t1 and t2 issued         |
|      and successfully submitted to RS)       |
|                       .                      |
|                       .                      |
|                       .                      |
|                                              |
|         (Access Token t1 is revoked)         |
|                                              |
|&lt;---------------------------------------------+
|                     2.05 CONTENT Observe: 53 |
|                      Payload: [bstr.h(t1)]   |
|                                              |
|                       .                      |
|                       .                      |
|                       .                      |
|                                              |
|         (Access Token t2 is revoked)         |
|                                              |
|&lt;---------------------------------------------+
|                     2.05 CONTENT Observe: 64 |
|                      Payload: [bstr.h(t1),   |
|                                bstr.h(t2)]   |
|                       .                      |
|                       .                      |
|                       .                      |
|                                              |
|         (Access Token t1 expires)            |
|                                              |
|&lt;---------------------------------------------+
|                     2.05 CONTENT Observe: 75 |
|                      Payload: [bstr.h(t2)]   |
|                        .                     |
|                        .                     |
|                        .                     |
|                                              |
|         (Access Token t2 expires)            |
|                                              |
|       X&lt;-------------------------------------+
|                     2.05 CONTENT Observe: 86 |
|                      Payload: []             |
|                        .                     |
|                        .                     |
|                        .                     |
|                                              |
|       (Enough time has passed since          |
|       the latest received notification)      |
|                                              |
| GET                                          |
|  coap://example.as.com/revoke/trl?diff=8     |
+---------------------------------------------&gt;|
|                                              |
|&lt;---------------------------------------------+
|            2.05 CONTENT                      |
|             Payload: [                       |
|                        [ [bstr.h(t2)], [] ], |
|                        [ [bstr.h(t1)], [] ], |
|                        [ [], [bstr.h(t2)] ], |
|                        [ [], [bstr.h(t1)] ]  |
|                      ]                       |
|                                              |
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-interaction-for-full-query-w" class="selfRef">Interaction for Full Query with Observation and Diff Query</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="sec-security-considerations">
<section id="section-11">
      <h2 id="name-security-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-11-1">Security considerations are inherited from the ACE framework for Authentication and Authorization <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>, from <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span> as to the usage of CWTs, from <span>[<a href="#RFC7519" class="xref">RFC7519</a>]</span> as to the usage of JWTs, from <span>[<a href="#RFC7641" class="xref">RFC7641</a>]</span> as to the usage of CoAP Observe, and from <span>[<a href="#RFC6920" class="xref">RFC6920</a>]</span> with regard to resource naming through hashes. The following considerations also apply.<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">The Authorization Server MUST ensure that each registered device can access and retrieve only its pertaining portion of the TRL. To this end, the Authorization Server can perform the required filtering based on the authenticated identity of the registered device, i.e., a (non-public) identifier that the Authorization Server can securely relate to the registered device and the secure association they use to communicate.<a href="#section-11-2" class="pilcrow">¶</a></p>
<p id="section-11-3">Disclosing any information about revoked Access Tokens to entities other than the intended registered devices may result in privacy concerns. Therefore, the Authorization Server MUST ensure that, other than registered devices accessing their own pertaining portion of the TRL, only authorized and authenticated administrators can retrieve the full TRL. To this end, the Authorization Server may rely on an access control list or similar.<a href="#section-11-3" class="pilcrow">¶</a></p>
<p id="section-11-4">If a registered device has many non-expired Access Tokens associated with itself that are revoked, the pertaining portion of the TRL could grow to a size bigger than what the registered device is prepared to handle upon reception, especially if relying on a full query of the TRL resource (see <a href="#ssec-trl-full-query" class="xref">Section 6</a>). This could be exploited by attackers to negatively affect the behaviour of a registered device. Issuing Access Tokens with not too long expiration time could help reduce the size of a TRL, but an Authorization Server SHOULD take measures to limit this size.<a href="#section-11-4" class="pilcrow">¶</a></p>
<p id="section-11-5">Most of the communication about revoked Access Tokens presented in this specification relies on CoAP Observe Notifications sent from the Authorization Server to a registered device. The suppression of those notifications by an external attacker that has access to the network would prevent registered devices from ever knowing that their pertaining Access Tokens have been revoked. To avoid this, a registered device SHOULD NOT rely solely on the CoAP Observe notifications. In particular, a registered device SHOULD also regularly poll the Authorization Server for the most current information about revoked Access Tokens, by sending GET requests to the TRL endpoint according to a related application policy.<a href="#section-11-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana">
<section id="section-12">
      <h2 id="name-iana-considerations">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-12-1">RFC EDITOR: Throughout this section, please replace [this document] with the RFC number of this specification and remove this note.<a href="#section-12-1" class="pilcrow">¶</a></p>
<p id="section-12-2">This document has the following actions for IANA.<a href="#section-12-2" class="pilcrow">¶</a></p>
<div id="iana-media-type">
<section id="section-12.1">
        <h3 id="name-media-type-registrations">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-media-type-registrations" class="section-name selfRef">Media Type Registrations</a>
        </h3>
<p id="section-12.1-1">IANA is asked to register the 'application/ace-trl+cbor' media type for messages of the protocols defined in this document encoded in CBOR. This registration follows the procedures specified in <span>[<a href="#RFC6838" class="xref">RFC6838</a>]</span>.<a href="#section-12.1-1" class="pilcrow">¶</a></p>
<p id="section-12.1-2">Type name: application<a href="#section-12.1-2" class="pilcrow">¶</a></p>
<p id="section-12.1-3">Subtype name: ace-trl+cbor<a href="#section-12.1-3" class="pilcrow">¶</a></p>
<p id="section-12.1-4">Required parameters: N/A<a href="#section-12.1-4" class="pilcrow">¶</a></p>
<p id="section-12.1-5">Optional parameters: N/A<a href="#section-12.1-5" class="pilcrow">¶</a></p>
<p id="section-12.1-6">Encoding considerations: Must be encoded as CBOR map containing the protocol parameters defined in [this document].<a href="#section-12.1-6" class="pilcrow">¶</a></p>
<p id="section-12.1-7">Security considerations: See <a href="#sec-security-considerations" class="xref">Section 11</a> of this document.<a href="#section-12.1-7" class="pilcrow">¶</a></p>
<p id="section-12.1-8">Interoperability considerations: N/A<a href="#section-12.1-8" class="pilcrow">¶</a></p>
<p id="section-12.1-9">Published specification: [this document]<a href="#section-12.1-9" class="pilcrow">¶</a></p>
<p id="section-12.1-10">Applications that use this media type: The type is used by Authorization Servers, Clients and Resource Servers that support the notification of revoked Access Tokens, according to a Token Revocation List maintained by the Authorization Server as specified in [this document].<a href="#section-12.1-10" class="pilcrow">¶</a></p>
<p id="section-12.1-11">Fragment identifier considerations: N/A<a href="#section-12.1-11" class="pilcrow">¶</a></p>
<p id="section-12.1-12">Additional information: N/A<a href="#section-12.1-12" class="pilcrow">¶</a></p>
<p id="section-12.1-13">Person &amp; email address to contact for further information: &lt;iesg@ietf.org&gt;<a href="#section-12.1-13" class="pilcrow">¶</a></p>
<p id="section-12.1-14">Intended usage: COMMON<a href="#section-12.1-14" class="pilcrow">¶</a></p>
<p id="section-12.1-15">Restrictions on usage: None<a href="#section-12.1-15" class="pilcrow">¶</a></p>
<p id="section-12.1-16">Author: Marco Tiloca &lt;marco.tiloca@ri.se&gt;<a href="#section-12.1-16" class="pilcrow">¶</a></p>
<p id="section-12.1-17">Change controller: IESG<a href="#section-12.1-17" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-content-type">
<section id="section-12.2">
        <h3 id="name-coap-content-formats-regist">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-coap-content-formats-regist" class="section-name selfRef">CoAP Content-Formats Registry</a>
        </h3>
<p id="section-12.2-1">IANA is asked to add the following entry to the "CoAP Content-Formats" registry within the "CoRE Parameters" registry group.<a href="#section-12.2-1" class="pilcrow">¶</a></p>
<p id="section-12.2-2">Media Type: application/ace-trl+cbor<a href="#section-12.2-2" class="pilcrow">¶</a></p>
<p id="section-12.2-3">Encoding: -<a href="#section-12.2-3" class="pilcrow">¶</a></p>
<p id="section-12.2-4">ID: TBD<a href="#section-12.2-4" class="pilcrow">¶</a></p>
<p id="section-12.2-5">Reference: [this document]<a href="#section-12.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-token-revocation-list">
<section id="section-12.3">
        <h3 id="name-token-revocation-list-regis">
<a href="#section-12.3" class="section-number selfRef">12.3. </a><a href="#name-token-revocation-list-regis" class="section-name selfRef">Token Revocation List Registry</a>
        </h3>
<p id="section-12.3-1">This specification establishes the "Token Revocation List" IANA registry. The
registry has been created to use the "Expert Review" registration procedure <span>[<a href="#RFC8126" class="xref">RFC8126</a>]</span>. Expert review guidelines are provided in <a href="#review" class="xref">Section 12.4</a>. It should be noted that, in addition to the expert review, some portions of the registry require a specification, potentially a Standards Track RFC, to be supplied as well.<a href="#section-12.3-1" class="pilcrow">¶</a></p>
<p id="section-12.3-2">The columns of this registry are:<a href="#section-12.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-12.3-3.1">Name: This is a descriptive name that enables easier reference to the item. The name MUST be unique. It is not used in the encoding.<a href="#section-12.3-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.3-3.2">CBOR Value: This is the value used as CBOR abbreviation of the item. These values MUST be unique. The value can be a positive integer or a negative integer. Different ranges of values use different registration policies <span>[<a href="#RFC8126" class="xref">RFC8126</a>]</span>. Integer values from -256 to 255 are designated as Standards Action. Integer values from -65536 to -257 and from 256 to 65535 are designated as Specification Required. Integer values greater than 65535 are designated as Expert Review. Integer values less than -65536 are marked as Private Use.<a href="#section-12.3-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.3-3.3">CBOR Type: This contains the CBOR type of the item, or a pointer to the registry that defines its type, when that depends on another item.<a href="#section-12.3-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.3-3.4">Reference: This contains a pointer to the public specification for the item.<a href="#section-12.3-3.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-12.3-4">This registry has been initially populated with the values from <a href="#fig-cbor-trl-params" class="xref">Figure 9</a> in <a href="#trl-registry-parameters" class="xref">Appendix A.4.4</a>.<a href="#section-12.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="review">
<section id="section-12.4">
        <h3 id="name-expert-review-instructions">
<a href="#section-12.4" class="section-number selfRef">12.4. </a><a href="#name-expert-review-instructions" class="section-name selfRef">Expert Review Instructions</a>
        </h3>
<p id="section-12.4-1">The IANA registry established in this document is defined as expert review. This section gives some general guidelines for what the experts should be looking for, but they are being designated as experts for a reason so they should be given substantial latitude.<a href="#section-12.4-1" class="pilcrow">¶</a></p>
<p id="section-12.4-2">Expert reviewers should take into consideration the following points:<a href="#section-12.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-12.4-3.1">Point squatting should be discouraged. Reviewers are encouraged to get sufficient information for registration requests to ensure that the usage is not going to duplicate one that is already registered and that the point is likely to be used in deployments. The zones tagged as private use are intended for testing purposes and closed environments, code points in other ranges should not be assigned for testing.<a href="#section-12.4-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.4-3.2">Specifications are required for the standards track range of point assignment. Specifications should exist for specification required ranges, but early assignment before a specification is available is considered to be permissible. Specifications are needed for the first-come, first-serve range if they are expected to be used outside of closed environments in an interoperable way. When specifications are not provided, the description provided needs to have sufficient information to identify what the point is being used for.<a href="#section-12.4-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-12.4-3.3">Experts should take into account the expected usage of fields when approving point assignment. The fact that there is a range for standards track documents does not mean that a standards track document cannot have points assigned outside of that range. The length of the encoded value should be weighed against how many code points of that length are left, the size of device it will be used on, and the number of code points left that encode to that size.<a href="#section-12.4-3.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<section id="section-13">
      <h2 id="name-references">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-13.1">
        <h3 id="name-normative-references">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments (ACE) using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-oauth-authz-46</span>, <time datetime="2021-11-08" class="refDate">8 November 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-ace-oauth-authz-46.txt">https://www.ietf.org/archive/id/draft-ietf-ace-oauth-authz-46.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-conditional-attributes">[I-D.ietf-core-conditional-attributes]</dt>
        <dd>
<span class="refAuthor">Koster, M.</span>, <span class="refAuthor">Soloway, A.</span>, and <span class="refAuthor">B. Silverajan</span>, <span class="refTitle">"Conditional Attributes for Constrained RESTful Environments"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-conditional-attributes-02</span>, <time datetime="2022-02-24" class="refDate">24 February 2022</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-core-conditional-attributes-02.txt">https://www.ietf.org/archive/id/draft-ietf-core-conditional-attributes-02.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Named.Information.Hash.Algorithm">[Named.Information.Hash.Algorithm]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Named Information Hash Algorithm"</span>, <span>&lt;<a href="https://www.iana.org/assignments/named-information/named-information.xhtml">https://www.iana.org/assignments/named-information/named-information.xhtml</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6749">[RFC6749]</dt>
        <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6749">https://www.rfc-editor.org/info/rfc6749</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6838">[RFC6838]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span>, <span class="refAuthor">Klensin, J.</span>, and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"Media Type Specifications and Registration Procedures"</span>, <span class="seriesInfo">BCP 13</span>, <span class="seriesInfo">RFC 6838</span>, <span class="seriesInfo">DOI 10.17487/RFC6838</span>, <time datetime="2013-01" class="refDate">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6838">https://www.rfc-editor.org/info/rfc6838</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6920">[RFC6920]</dt>
        <dd>
<span class="refAuthor">Farrell, S.</span>, <span class="refAuthor">Kutscher, D.</span>, <span class="refAuthor">Dannewitz, C.</span>, <span class="refAuthor">Ohlman, B.</span>, <span class="refAuthor">Keranen, A.</span>, and <span class="refAuthor">P. Hallam-Baker</span>, <span class="refTitle">"Naming Things with Hashes"</span>, <span class="seriesInfo">RFC 6920</span>, <span class="seriesInfo">DOI 10.17487/RFC6920</span>, <time datetime="2013-04" class="refDate">April 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6920">https://www.rfc-editor.org/info/rfc6920</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7252">https://www.rfc-editor.org/info/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7519">[RFC7519]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">N. Sakimura</span>, <span class="refTitle">"JSON Web Token (JWT)"</span>, <span class="seriesInfo">RFC 7519</span>, <span class="seriesInfo">DOI 10.17487/RFC7519</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7519">https://www.rfc-editor.org/info/rfc7519</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7641">[RFC7641]</dt>
        <dd>
<span class="refAuthor">Hartke, K.</span>, <span class="refTitle">"Observing Resources in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7641</span>, <span class="seriesInfo">DOI 10.17487/RFC7641</span>, <time datetime="2015-09" class="refDate">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7641">https://www.rfc-editor.org/info/rfc7641</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time datetime="2017-06" class="refDate">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8259">[RFC8259]</dt>
        <dd>
<span class="refAuthor">Bray, T., Ed.</span>, <span class="refTitle">"The JavaScript Object Notation (JSON) Data Interchange Format"</span>, <span class="seriesInfo">STD 90</span>, <span class="seriesInfo">RFC 8259</span>, <span class="seriesInfo">DOI 10.17487/RFC8259</span>, <time datetime="2017-12" class="refDate">December 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8259">https://www.rfc-editor.org/info/rfc8259</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8392">[RFC8392]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"CBOR Web Token (CWT)"</span>, <span class="seriesInfo">RFC 8392</span>, <span class="seriesInfo">DOI 10.17487/RFC8392</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8392">https://www.rfc-editor.org/info/rfc8392</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8610">https://www.rfc-editor.org/info/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
      <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8949">https://www.rfc-editor.org/info/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-13.2">
        <h3 id="name-informative-references">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.bormann-t2trg-stp">[I-D.bormann-t2trg-stp]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">K. Hartke</span>, <span class="refTitle">"The Series Transfer Pattern (STP)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-bormann-t2trg-stp-03</span>, <time datetime="2020-04-07" class="refDate">7 April 2020</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-bormann-t2trg-stp-03.txt">https://www.ietf.org/archive/id/draft-bormann-t2trg-stp-03.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7009">[RFC7009]</dt>
      <dd>
<span class="refAuthor">Lodderstedt, T., Ed.</span>, <span class="refAuthor">Dronia, S.</span>, and <span class="refAuthor">M. Scurtescu</span>, <span class="refTitle">"OAuth 2.0 Token Revocation"</span>, <span class="seriesInfo">RFC 7009</span>, <span class="seriesInfo">DOI 10.17487/RFC7009</span>, <time datetime="2013-08" class="refDate">August 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7009">https://www.rfc-editor.org/info/rfc7009</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="sec-cursor-pattern">
<section id="appendix-A">
      <h2 id="name-usage-of-the-cursor-pattern">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-usage-of-the-cursor-pattern" class="section-name selfRef">Usage of the "Cursor" Pattern</a>
      </h2>
<p id="appendix-A-1">This section defines how the diff query of the TRL specified in <a href="#ssec-trl-diff-query" class="xref">Section 7</a> can be extended, by using the "Cursor" pattern of the Series Transfer Pattern (see <span><a href="https://datatracker.ietf.org/doc/html/draft-bormann-t2trg-stp-03#section-3.3" class="relref">Section 3.3</a> of [<a href="#I-D.bormann-t2trg-stp" class="xref">I-D.bormann-t2trg-stp</a>]</span>).<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">[ TODO<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">Make this an actual third query mode, which means:<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-4.1">What is defined below for "Full Query Response" becomes part of the full query processing in the document body.<a href="#appendix-A-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-4.2">The diff-query processing in the document body is unchanged.<a href="#appendix-A-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-4.3">What is defined below for "Diff Query Request" and "Diff Query Response" defines this third query mode, which can also be moved to the document body.<a href="#appendix-A-4.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-4.4">An example about this third query mode can be added in "Interaction Examples".<a href="#appendix-A-4.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-A-5">]<a href="#appendix-A-5" class="pilcrow">¶</a></p>
<p id="appendix-A-6">This has two benefits. First, the Authorization Server can avoid excessively big latencies when several diff entries have to be transferred, by delivering one adjacent subset at the time, in different diff query responses. Second, a requester can retrieve diff entries associated with TRL updates that, even if not the most recent ones, occurred after a TRL update indicated as reference point.<a href="#appendix-A-6" class="pilcrow">¶</a></p>
<p id="appendix-A-7">To this end, each series item in an update collection is also associated with an unsigned integer 'index', with value the absolute counter of series items added to that collection minus 1. That is, the first series item added to a collection has 'index' with value 0. Then, the values of 'index' are used as cursor information.<a href="#appendix-A-7" class="pilcrow">¶</a></p>
<p id="appendix-A-8">Furthermore, the Authorization Server defines an unsigned integer MAX_DIFF_BATCH &lt;= N_MAX, specifying the maximum number of diff entries to be included in a single diff query response. If supporting diff queries, the Authorization Server SHOULD provide registered devices and administrators with the value of MAX_DIFF_BATCH, upon their registration (see <a href="#sec-registration" class="xref">Section 8</a>).<a href="#appendix-A-8" class="pilcrow">¶</a></p>
<p id="appendix-A-9">Finally, the full query and diff query exchanges defined in <a href="#ssec-trl-full-query" class="xref">Section 6</a> and <a href="#ssec-trl-diff-query" class="xref">Section 7</a> are extended as follows.<a href="#appendix-A-9" class="pilcrow">¶</a></p>
<p id="appendix-A-10">In particular, successful responses from the TRL endpoint MUST use the Content-Format "application/ace-trl+cbor" defined in <a href="#iana-content-type" class="xref">Section 12.2</a> of this specification.<a href="#appendix-A-10" class="pilcrow">¶</a></p>
<div id="ssec-trl-full-query-extended-req">
<section id="appendix-A.1">
        <h3 id="name-full-query-request">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-full-query-request" class="section-name selfRef">Full Query Request</a>
        </h3>
<p id="appendix-A.1-1">No changes apply to what is defined in <a href="#ssec-trl-full-query" class="xref">Section 6</a>.<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="full-query-response">
<section id="appendix-A.2">
        <h3 id="name-full-query-response">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-full-query-response" class="section-name selfRef">Full Query Response</a>
        </h3>
<p id="appendix-A.2-1">When sending a 2.05 (Content) response to a full query request (see <a href="#ssec-trl-full-query-extended-req" class="xref">Appendix A.1</a>), the response payload includes a CBOR map with the following fields, whose CBOR labels are defined in <a href="#trl-registry-parameters" class="xref">Appendix A.4.4</a>.<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-2.1">'full-set': this field MUST include a CBOR array of token hashes. The CBOR array is populated and formatted as defined for the CBOR array 'full-set' in <a href="#ssec-trl-full-query" class="xref">Section 6</a>.<a href="#appendix-A.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="appendix-A.2-2.2">
            <p id="appendix-A.2-2.2.1">'cursor': this field MUST include either the CBOR simple value "null" (0xf6) or a CBOR unsigned integer.<a href="#appendix-A.2-2.2.1" class="pilcrow">¶</a></p>
<p id="appendix-A.2-2.2.2">
The CBOR simple value "null" MUST be used to indicate that there are currently no TRL updates pertinent to the requester, i.e., the update collection for that requester is empty. This is the case from when the requester registers at the Authorization Server until a first update pertaining that requester occurs to the TRL.<a href="#appendix-A.2-2.2.2" class="pilcrow">¶</a></p>
<p id="appendix-A.2-2.2.3">
Otherwise, the field MUST include a CBOR unsigned integer, encoding the 'index' value of the last series item in the collection, as corresponding to the most recent update pertaining to the requester occurred to the TRL.<a href="#appendix-A.2-2.2.3" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="ssec-trl-diff-query-extended-req">
<section id="appendix-A.3">
        <h3 id="name-diff-query-request">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-diff-query-request" class="section-name selfRef">Diff Query Request</a>
        </h3>
<p id="appendix-A.3-1">In addition to the query parameter 'diff' (see <a href="#ssec-trl-diff-query" class="xref">Section 7</a>), the requester can specify a query parameter 'cursor', with value an unsigned integer.<a href="#appendix-A.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="diff-query-response">
<section id="appendix-A.4">
        <h3 id="name-diff-query-response">
<a href="#appendix-A.4" class="section-number selfRef">A.4. </a><a href="#name-diff-query-response" class="section-name selfRef">Diff Query Response</a>
        </h3>
<p id="appendix-A.4-1">The Authorization Server composes a response to a diff query request (see <a href="#ssec-trl-diff-query-extended-req" class="xref">Appendix A.3</a>) as follows, depending on the parameters specified in the request and on the current status of the update collection for the requester.<a href="#appendix-A.4-1" class="pilcrow">¶</a></p>
<div id="empty-collection">
<section id="appendix-A.4.1">
          <h4 id="name-empty-collection">
<a href="#appendix-A.4.1" class="section-number selfRef">A.4.1. </a><a href="#name-empty-collection" class="section-name selfRef">Empty Collection</a>
          </h4>
<p id="appendix-A.4.1-1">If the collection associated with the requester has no elements, the Authorization Server returns a 2.05 (Content) diff query response.<a href="#appendix-A.4.1-1" class="pilcrow">¶</a></p>
<p id="appendix-A.4.1-2">The response payload includes a CBOR map with the following fields, whose CBOR labels are defined in <a href="#trl-registry-parameters" class="xref">Appendix A.4.4</a>.<a href="#appendix-A.4.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.4.1-3.1">'diff-set': this field MUST include an empty CBOR array.<a href="#appendix-A.4.1-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.4.1-3.2">'cursor': this field MUST include the CBOR simple value "null" (0xf6).<a href="#appendix-A.4.1-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.4.1-3.3">'more': this field MUST include the CBOR simple value "false" (0xf4).<a href="#appendix-A.4.1-3.3" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="sec-cursor-pattern-response-to-no-cursor-request">
<section id="appendix-A.4.2">
          <h4 id="name-cursor-not-specified-in-the">
<a href="#appendix-A.4.2" class="section-number selfRef">A.4.2. </a><a href="#name-cursor-not-specified-in-the" class="section-name selfRef">Cursor Not Specified in the Diff Query Request</a>
          </h4>
<p id="appendix-A.4.2-1">If the update collection associated with the requester is not empty and the diff query request does not include the query parameter 'cursor', the Authorization Server returns a 2.05 (Content) diff query response.<a href="#appendix-A.4.2-1" class="pilcrow">¶</a></p>
<p id="appendix-A.4.2-2">The response payload includes a CBOR map with the following fields, whose CBOR labels are defined in <a href="#trl-registry-parameters" class="xref">Appendix A.4.4</a>.<a href="#appendix-A.4.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.4.2-3.1">
              <p id="appendix-A.4.2-3.1.1">'diff-set': this field MUST include a CBOR array, containing L = min(U, MAX_DIFF_BATCH) diff entries. In particular, the CBOR array is populated as follows.<a href="#appendix-A.4.2-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.4.2-3.1.2.1">If U &lt;= MAX_DIFF_BATCH, these diff entries are the last series items in the collection associated with the requester, corresponding to the L most recent TRL updates pertaining to the requester.<a href="#appendix-A.4.2-3.1.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="appendix-A.4.2-3.1.2.2">If U &gt; MAX_DIFF_BATCH, these diff entries are the eldest of the last U series items in the collection associated with the requester, as corresponding to the first L of the U most recent TRL updates pertaining to the requester.<a href="#appendix-A.4.2-3.1.2.2" class="pilcrow">¶</a>
</li>
              </ul>
<p id="appendix-A.4.2-3.1.3">
The 'diff-set' CBOR array as well as the individual diff entries have the same format specified in <a href="#cddl-diff" class="xref">Figure 5</a> and used for the response payload defined in <a href="#ssec-trl-diff-query" class="xref">Section 7</a>.<a href="#appendix-A.4.2-3.1.3" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-A.4.2-3.2">
              <p id="appendix-A.4.2-3.2.1">'cursor': this field MUST include a CBOR unsigned integer. This takes the 'index' value of the series element of the collection included as first diff entry in the 'diff-set' CBOR array. That is, it takes the 'index' value of the series item in the collection corresponding to the most recent update pertaining to the requester and returned in this diff query response.<a href="#appendix-A.4.2-3.2.1" class="pilcrow">¶</a></p>
<p id="appendix-A.4.2-3.2.2">
Note that 'cursor' takes the same 'index' value of the last series item in the collection when U &lt;= MAX_DIFF_BATCH.<a href="#appendix-A.4.2-3.2.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-A.4.2-3.3">
              <p id="appendix-A.4.2-3.3.1">'more': this field MUST include the CBOR simple value "false" (0xf4) if U &lt;= MAX_DIFF_BATCH, or the CBOR simple value "true" (0xf5) otherwise.<a href="#appendix-A.4.2-3.3.1" class="pilcrow">¶</a></p>
<p id="appendix-A.4.2-3.3.2">
If 'more' has value "true", the requester can send a follow-up diff query request including the query parameter 'cursor', with the same value of the 'cursor' field included in this diff query response. As defined in <a href="#sec-cursor-pattern-response-to-with-cursor-request" class="xref">Appendix A.4.3</a>, this would result in the Authorization Server transferring the following subset of series items as diff entries, i.e., resuming from where interrupted in the previous transfer.<a href="#appendix-A.4.2-3.3.2" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="sec-cursor-pattern-response-to-with-cursor-request">
<section id="appendix-A.4.3">
          <h4 id="name-cursor-specified-in-the-dif">
<a href="#appendix-A.4.3" class="section-number selfRef">A.4.3. </a><a href="#name-cursor-specified-in-the-dif" class="section-name selfRef">Cursor Specified in the Diff Query Request</a>
          </h4>
<p id="appendix-A.4.3-1">If the update collection associated with the requester is not empty and the diff query request includes the query parameter 'cursor' with value P, the Authorization Server proceeds as follows.<a href="#appendix-A.4.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.4.3-2.1">The Authorization Server MUST return a 4.00 (Bad Request) response in case the 'cursor' parameter specifies a value other than 0 or than a positive integer.<a href="#appendix-A.4.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-A.4.3-2.2">
              <p id="appendix-A.4.3-2.2.1">If no series item X with 'index' having value P is found in the collection associated with the requester, then that item has been previously removed from the history of updates for that requester (see <a href="#sec-series-pattern" class="xref">Section 7.1</a>). In this case, the Authorization Server returns a 2.05 (Content) diff query response.<a href="#appendix-A.4.3-2.2.1" class="pilcrow">¶</a></p>
<p id="appendix-A.4.3-2.2.2">
The response payload includes a CBOR map with the following fields, whose CBOR labels are defined in <a href="#trl-registry-parameters" class="xref">Appendix A.4.4</a>.<a href="#appendix-A.4.3-2.2.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.4.3-2.2.3.1">'diff-set': this field MUST include an empty CBOR array.<a href="#appendix-A.4.3-2.2.3.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="appendix-A.4.3-2.2.3.2">'cursor': this field MUST include the CBOR simple value "null" (0xf6).<a href="#appendix-A.4.3-2.2.3.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="appendix-A.4.3-2.2.3.3">'more': this field MUST include the CBOR simple value "true" (0xf5).<a href="#appendix-A.4.3-2.2.3.3" class="pilcrow">¶</a>
</li>
              </ul>
<p id="appendix-A.4.3-2.2.4">
With the combination ('cursor', 'more') = ("null", "true"), the Authorization Server is signaling that the update collection is in fact not empty, but that some series items have been lost due to their removal, including the item with 'index' value P that the requester wished to use as reference point.<a href="#appendix-A.4.3-2.2.4" class="pilcrow">¶</a></p>
<p id="appendix-A.4.3-2.2.5">
When receiving this diff query response, the requester should send a new full query request to the Authorization Server, in order to fully retrieve the current pertaining portion of the TRL.<a href="#appendix-A.4.3-2.2.5" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-A.4.3-2.3">
              <p id="appendix-A.4.3-2.3.1">If the series item X with 'index' having value P is found in the collection associated with the requester, the Authorization Server returns a 2.05 (Content) diff query response.<a href="#appendix-A.4.3-2.3.1" class="pilcrow">¶</a></p>
<p id="appendix-A.4.3-2.3.2">
The response payload includes a CBOR map with the following fields, whose CBOR labels are defined in <a href="#trl-registry-parameters" class="xref">Appendix A.4.4</a>.<a href="#appendix-A.4.3-2.3.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.4.3-2.3.3.1">
                  <p id="appendix-A.4.3-2.3.3.1.1">'diff-set': this field MUST include a CBOR array, containing L = min(SUB_U, MAX_DIFF_BATCH) diff entries, where SUB_U = min(NUM, SUB_SIZE), and SUB_SIZE is the number of series items in the collection following the series item X.<a href="#appendix-A.4.3-2.3.3.1.1" class="pilcrow">¶</a></p>
<p id="appendix-A.4.3-2.3.3.1.2">
That is, these are the L updates pertaining to the requester that immediately follow the series item X indicated as reference point. In particular, the CBOR array is populated as follows.<a href="#appendix-A.4.3-2.3.3.1.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.4.3-2.3.3.1.3.1">If SUB_U &lt;= MAX_DIFF_BATCH, these diff entries are the last series items in the collection associated with the requester, corresponding to the L most recent TRL updates pertaining to the requester.<a href="#appendix-A.4.3-2.3.3.1.3.1" class="pilcrow">¶</a>
</li>
                    <li class="normal" id="appendix-A.4.3-2.3.3.1.3.2">If SUB_U &gt; MAX_DIFF_BATCH, these diff entries are the eldest of the last SUB_U series items in the collection associated with the requester, corresponding to the first L of the SUB_U most recent TRL updates pertaining to the requester.<a href="#appendix-A.4.3-2.3.3.1.3.2" class="pilcrow">¶</a>
</li>
                  </ul>
<p id="appendix-A.4.3-2.3.3.1.4">
The 'diff-set' CBOR array as well as the individual diff entries have the same format specified in <a href="#cddl-diff" class="xref">Figure 5</a> and used for the response payload defined in <a href="#ssec-trl-diff-query" class="xref">Section 7</a>.<a href="#appendix-A.4.3-2.3.3.1.4" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.4.3-2.3.3.2">
                  <p id="appendix-A.4.3-2.3.3.2.1">'cursor': this field MUST include a CBOR unsigned integer. In particular:<a href="#appendix-A.4.3-2.3.3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.4.3-2.3.3.2.2.1">If L is equal to 0, i.e., the series item X is the last one in the collection, 'cursor' takes the same 'index' value of the last series item in the collection.<a href="#appendix-A.4.3-2.3.3.2.2.1" class="pilcrow">¶</a>
</li>
                    <li class="normal" id="appendix-A.4.3-2.3.3.2.2.2">If L is different than 0, 'cursor' takes the 'index' value of the series element of the collection included as first diff entry in the 'diff-set' CBOR array. That is, it takes the 'index' value of the series item in the collection corresponding to the most recent update pertaining to the requester and returned in this diff query response.<a href="#appendix-A.4.3-2.3.3.2.2.2" class="pilcrow">¶</a>
</li>
                  </ul>
<p id="appendix-A.4.3-2.3.3.2.3">
Note that 'cursor' takes the same 'index' value of the last series item in the collection when SUB_U &lt;= MAX_DIFF_BATCH.<a href="#appendix-A.4.3-2.3.3.2.3" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="appendix-A.4.3-2.3.3.3">
                  <p id="appendix-A.4.3-2.3.3.3.1">'more': this field MUST include the CBOR simple value "false" (0xf4) if SUB_U &lt;= MAX_DIFF_BATCH, or the CBOR simple value "true" (0xf5) otherwise.<a href="#appendix-A.4.3-2.3.3.3.1" class="pilcrow">¶</a></p>
<p id="appendix-A.4.3-2.3.3.3.2">
If 'more' has value "true", the requester can send a follow-up diff query request including the query parameter 'cursor', with the same value of the 'cursor' field specified in this diff query response. This would result in the Authorization Server transferring the following subset of series items as diff entries, i.e., resuming from where interrupted in the previous transfer.<a href="#appendix-A.4.3-2.3.3.3.2" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ul>
</section>
</div>
<div id="trl-registry-parameters">
<section id="appendix-A.4.4">
          <h4 id="name-trl-parameters">
<a href="#appendix-A.4.4" class="section-number selfRef">A.4.4. </a><a href="#name-trl-parameters" class="section-name selfRef">TRL Parameters</a>
          </h4>
<p id="appendix-A.4.4-1">RFC EDITOR: Throughout this section, please replace [this document] with the RFC number of this specification and remove this note.<a href="#appendix-A.4.4-1" class="pilcrow">¶</a></p>
<p id="appendix-A.4.4-2">This specification defines a number of fields used in the response to a diff query request to the TRL endpoint relying on the "Cursor" pattern, as defined in <a href="#sec-cursor-pattern" class="xref">Appendix A</a>.<a href="#appendix-A.4.4-2" class="pilcrow">¶</a></p>
<p id="appendix-A.4.4-3">The table below summarizes them, and specifies the CBOR value to use as abbreviation instead of the full descriptive name. Note that the Content-Format "application/ace-trl+cbor" defined in <a href="#iana-content-type" class="xref">Section 12.2</a> of this specification MUST be used when these fields are transported.<a href="#appendix-A.4.4-3" class="pilcrow">¶</a></p>
<span id="name-cbor-abbreviations-for-trl-"></span><div id="fig-cbor-trl-params">
<figure id="figure-9">
            <div class="alignCenter art-text artwork" id="appendix-A.4.4-4.1">
<pre>
+----------+------------+-----------------------+-----------+
| Name     | CBOR Value | CBOR Type             | Reference |
+----------+------------+-----------------------+-----------+
| full-set | TBD        | array                 | [this     |
|          |            |                       | document] |
+----------+------------+-----------------------+-----------+
| cursor   | TBD        | simple value "null" / | [this     |
|          |            | unsigned integer      | document] |
+----------+------------+-----------------------+-----------+
| diff-set | TBD        | array                 | [this     |
|          |            |                       | document] |
+----------+------------+-----------------------+-----------+
| more     | TBD        | simple value "true"   | [this     |
|          |            | or "false"            | document] |
+----------+------------+-----------------------+-----------+
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-cbor-abbreviations-for-trl-" class="selfRef">CBOR abbreviations for TRL parameters</a>
            </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-document-updates">
<section id="appendix-B">
      <h2 id="name-document-updates">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-document-updates" class="section-name selfRef">Document Updates</a>
      </h2>
<p id="appendix-B-1">RFC EDITOR: Please remove this section.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<div id="sec-0-01">
<section id="appendix-B.1">
        <h3 id="name-version-00-to-01">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-version-00-to-01" class="section-name selfRef">Version -00 to -01</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-B.1-1.1">Section restructuring (full- and diff-query as self-standing sections; usage of series transfer pattern moved to the document body).<a href="#appendix-B.1-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="appendix-B.1-1.2">Renamed identifiers and CBOR parameters.<a href="#appendix-B.1-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="appendix-B.1-1.3">Clarifications and editorial improvements.<a href="#appendix-B.1-1.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="acknowldegment">
<section id="appendix-C">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-C-1">The authors sincerely thank Carsten Bormann, Benjamin Kaduk, Marco Rasori, Michael Richardson, Jim Schaad, Goeran Selander and Travis Spencer for their comments and feedback.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<p id="appendix-C-2">The work on this document has been partly supported by VINNOVA and the Celtic-Next project CRITISEC; and by the H2020 project SIFIS-Home (Grant agreement 952652).<a href="#appendix-C-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Marco Tiloca</span></div>
<div dir="auto" class="left"><span class="org">RISE AB</span></div>
<div dir="auto" class="left"><span class="street-address">Isafjordsgatan 22</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:marco.tiloca@ri.se" class="email">marco.tiloca@ri.se</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Ludwig Seitz</span></div>
<div dir="auto" class="left"><span class="org">Combitech</span></div>
<div dir="auto" class="left"><span class="street-address">Djaeknegatan 31</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">21135</span> <span class="locality">Malmoe</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ludwig.seitz@combitech.com" class="email">ludwig.seitz@combitech.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Francesca Palombini</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="street-address">Torshamnsgatan 23</span></div>
<div dir="auto" class="left">SE-<span class="postal-code">16440</span> <span class="locality">Kista</span>
</div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:francesca.palombini@ericsson.com" class="email">francesca.palombini@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Sebastian Echeverria</span></div>
<div dir="auto" class="left"><span class="org">CMU SEI</span></div>
<div dir="auto" class="left"><span class="street-address">4500 Fifth Avenue</span></div>
<div dir="auto" class="left">
<span class="locality">Pittsburgh, PA</span>,  <span class="postal-code">15213-2612</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:secheverria@sei.cmu.edu" class="email">secheverria@sei.cmu.edu</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Grace Lewis</span></div>
<div dir="auto" class="left"><span class="org">CMU SEI</span></div>
<div dir="auto" class="left"><span class="street-address">4500 Fifth Avenue</span></div>
<div dir="auto" class="left">
<span class="locality">Pittsburgh, PA</span>,  <span class="postal-code">15213-2612</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:glewis@sei.cmu.edu" class="email">glewis@sei.cmu.edu</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
